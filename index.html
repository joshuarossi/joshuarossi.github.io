<!doctype html>
<html lang='en-GB'>

<head>
	<meta charset='utf-8'>
	<title>Ractive test</title>
</head>

<body>
	<!--
	1. This is the element we'll render our Ractive to.
	-->
	<div id='container'></div>

	<!--
	2. You can load a template in many ways. For convenience, we'll include it in
	a script tag so that we don't need to mess around with AJAX or multiline strings.
	Note that we've set the type attribute to 'text/ractive' - though it can be
	just about anything except 'text/javascript'
	-->
	<script id='template' type='text/ractive'>
		<p>Ticker</t>
			{{#ticker}}
			<table>
				<tr>
					<th></th>
					<th>Bid</th>
					<th>Ask</th>
				</tr>
				<tr>
					<td>Price</td>
					<td>{{bid_price}}</td>
					<td>{{ask_price}}</td>
				</tr>
				<tr>
					<td>Amount</td>
					<td>{{bid_amount}}</td>
					<td>{{ask_amount}}</td>
				</tr>
			</table>
			{{/ticker}}
	</script>

	<script src='./ractive.min.js'></script>

	<!--
	4. We've got an element in the DOM, we've created a template, and we've
	loaded the library - now it's time to build our Hello World app.
	-->
	<script>
		name = 'josh'
		var ractive = new Ractive({
			// The `el` option can be a node, an ID, or a CSS selector.
			el: '#container',

			// We could pass in a string, but for the sake of convenience
			// we're passing the ID of the <script> tag above.
			template: '#template',

			// Here, we're passing in some initial data
			data: {
				ticker: {
					bid_price: 0,
					bid_amount: 0,
					ask_price: 0,
					ask_amount: 0
				}
			}
		})
		ws = new WebSocket('wss://api.bitfinex.com/ws/2')
		ws.addEventListener('open', x => {
			ws.send(JSON.stringify({
				event: 'subscribe',
				symbol: 'tXMRUSD',
				channel: 'ticker'
			}))
		})
		ws.addEventListener('message', x => {
			let ticker = JSON.parse(x.data)[1]
			if (ticker != 'hb') {
				x = {
					bid_price: ticker[0],
					bid_amount: ticker[1],
					ask_price: ticker[2],
					ask_amount: ticker[3]
				}
				ractive.set('ticker', x)
			}
		})
	</script>
</body>

</html>